-- 1. 基础准备：获取玩家与PlayerGui（确保重生后UI不销毁）
local Player = game.Players.LocalPlayer
local PlayerGui = Player:WaitForChild("PlayerGui") -- 重生后PlayerGui内容不会重置

-- 2. 创建核心UI容器（ResetOnSpawn设为false，防止重生销毁）
local KeyGui = Instance.new("ScreenGui")
KeyGui.Name = "KeyInputGui"
KeyGui.ResetOnSpawn = false -- 关键属性：重生不销毁UI
KeyGui.Parent = PlayerGui

-- 3. 创建密钥输入窗口（Frame）
local KeyFrame = Instance.new("Frame")
KeyFrame.Name = "KeyWindow"
KeyFrame.Size = UDim2.new(0, 400, 0, 200) -- 大小：400x200
KeyFrame.Position = UDim2.new(0.5, -200, 0.5, -100) -- 居中（偏移量为大小的一半）
KeyFrame.BackgroundColor3 = Color3.new(1, 1, 1) -- 白色背景
KeyFrame.BorderSizePixel = 0 -- 无边框
KeyFrame.Parent = KeyGui

-- 4. 创建“输入密匙”文本（左上角）
local KeyLabel = Instance.new("TextLabel")
KeyLabel.Name = "KeyText"
KeyLabel.Text = "輸入密匙"
KeyLabel.TextColor3 = Color3.new(0, 0, 0) -- 黑色文字
KeyLabel.Size = UDim2.new(0, 120, 0, 30)
KeyLabel.Position = UDim2.new(0, 10, 0, 10) -- 左上角偏移10像素
KeyLabel.BackgroundTransparency = 1 -- 透明背景
KeyLabel.Parent = KeyFrame

-- 5. 创建密钥输入框（右侧）
local KeyTextBox = Instance.new("TextBox")
KeyTextBox.Name = "KeyInput"
KeyTextBox.Size = UDim2.new(0, 240, 0, 30)
KeyTextBox.Position = UDim2.new(0, 150, 0, 10) -- 右侧与文本对齐
KeyTextBox.PlaceholderText = "請輸入密匙..."
KeyTextBox.BorderSizePixel = 1
KeyTextBox.BorderColor3 = Color3.new(0.5, 0.5, 0.5)
KeyTextBox.Parent = KeyFrame

-- 6. 密钥验证逻辑（输入完成后触发）
KeyTextBox.FocusLost:Connect(function(enterPressed)
    if enterPressed then -- 按回车确认输入
        local inputKey = KeyTextBox.Text
        if inputKey == "FKH_86848" then -- 验证正确密钥
            KeyGui:Destroy() -- 销毁输入窗口
            -- 7. 运行指定的OrionLib菜单代码（已修正原代码语法错误）
            local OrionLib = loadstring(game:HttpGet("https://raw.githubusercontent.com/jingbof50-lab/roblox_universe_script/refs/heads/main/scripting_framework.lua"))()
            local Window = OrionLib:MakeWindow({
                IntroText = "宇宙",
                Name = "宇宙" .. (identifyexecutor() or "未知执行器"), -- 兼容无identifyexecutor()的环境
                HidePremium = false,
                SaveConfig = true,
                ConfigFolder = "OrionConfig_宇宙"
            })
            -- 首页Tab
            local HomeTab = Window:MakeTab({Name = "首頁", Icon = "rbxassetid://4458855809", PremiumOnly = false})
            HomeTab:AddButton({
                Name = "作者 快手號:4708518336",
                Callback = function()
                    getgenv().XiaoPi = "作者 快手號:4708518336"
                    loadstring(game:HttpGet("https://raw.githubusercontent.com/jingbof50-lab/roblox_universe_script/main/script_simple"))()
                end
            })
            -- 功能Tab
            local FuncTab = Window:MakeTab({Name = "功能", Icon = "rbxassetid://7733779610", PremiumOnly = false})
            FuncTab:AddButton({Name = "飛行", Callback = function() getgenv().XiaoPi = "飛行"; loadstring(game:HttpGet("https://raw.githubusercontent.com/jingbof50-lab/roblox_universe_script/main/script_flight"))() end})
            FuncTab:AddButton({Name = "自動旋轉", Callback = function() getgenv().XiaoPi = "自動旋轉"; loadstring(game:HttpGet("https://raw.githubusercontent.com/jingbof50-lab/roblox_universe_script/main/script_auto-rotation"))() end})
            FuncTab:AddButton({Name = "飛行(超人動畫)", Callback = function() getgenv().XiaoPi = "飛行(超人動畫)"; loadstring(game:HttpGet("https://raw.githubusercontent.com/jingbof50-lab/roblox_universe_script/main/script_superman_flight"))() end})
            FuncTab:AddButton({Name = "甩飛腳本(肘擊)", Callback = function() getgenv().XiaoPi = "甩飛腳本（肘擊)"; loadstring(game:HttpGet("https://raw.githubusercontent.com/jingbof50-lab/roblox_universe_script/main/script_throw_away"))() end})
            -- 武器獲得Tab
            local WeaponTab = Window:MakeTab({Name = "武器獲得", Icon = "rbxassetid://7825183411", PremiumOnly = false})
            WeaponTab:AddButton({Name = "傳送工具", Callback = function() getgenv().XiaoPi = "傳送工具"; loadstring(game:HttpGet("https://raw.githubusercontent.com/jingbof50-lab/roblox_universe_script/main/scrript_click-to-deliver"))() end})
            WeaponTab:AddButton({Name = "破壞之錘(可以破壞地圖的方塊)", Callback = function() getgenv().XiaoPi = "破壞之錘(可以破壞地圖的方塊)"; loadstring(game:HttpGet("https://raw.githubusercontent.com/jingbof50-lab/roblox_universe_script/main/script_hammer_destruction"))() end})
            WeaponTab:AddButton({Name = "火箭筒", Callback = function() getgenv().XiaoPi = "火箭筒"; loadstring(game:HttpGet("https://raw.githubusercontent.com/jingbof50-lab/roblox_universe_script/main/script_bazooka"))() end})
            -- 擴展菜單Tab
            local ExtendTab = Window:MakeTab({Name = "擴展菜單", Icon = "rbxassetid://133104953772161", PremiumOnly = false})
            ExtendTab:AddButton({Name = "dex(修改器)", Callback = function() getgenv().XiaoPi = "dex(修改器)"; loadstring(game:HttpGet("https://raw.githubusercontent.com/jingbof50-lab/roblox_universe_script/main/script_dex"))() end})
            ExtendTab:AddButton({Name = "動作跳舞菜單(R15)", Callback = function() getgenv().XiaoPi = "動作跳舞菜單(R15)"; loadstring(game:HttpGet("https://raw.githubusercontent.com/jingbof50-lab/roblox_universe_script/main/script_action_menu"))() end}) -- 修正原代码"lloadstring"拼写错误
            ExtendTab:AddButton({Name = "透視菜單", Callback = function() getgenv().XiaoPi = "透視菜單"; loadstring(game:HttpGet("https://raw.githubusercontent.com/jingbof50-lab/roblox_universe_script/main/script_EFP"))() end})
            ExtendTab:AddButton({Name = "物體控制菜單", Callback = function() getgenv().XiaoPi = "物體控制菜單"; loadstring(game:HttpGet("https://raw.githubusercontent.com/jingbof50-lab/roblox_universe_script/main/script_controlled_items"))() end})
            ExtendTab:AddButton({Name = "地圖貼圖修改", Callback = function() getgenv().XiaoPi = "地圖貼圖修改"; loadstring(game:HttpGet("https://raw.githubusercontent.com/jingbof50-lab/roblox_universe_script/main/script_map_change"))() end})
            -- 最強戰場Tab
            local BattleTab = Window:MakeTab({Name = "最強戰場", Icon = "rbxassetid://111934201357670", PremiumOnly = false})
            BattleTab:AddButton({Name = "特效", Callback = function() getgenv().XiaoPi = "特效"; loadstring(game:HttpGet("https://raw.githubusercontent.com/IdkRandomUsernameok/PublicAssets/refs/heads/main/Releases/MUI.lua"))() end})
            BattleTab:AddButton({Name = "五条悟(最強英雄)", Callback = function() getgenv().XiaoPi = "五条悟(最強英雄)"; loadstring(game:HttpGet("https://raw.githubusercontent.com/jingbof50-lab/roblox_universe_script/main/script_gojo_satoru_all.lua"))() end})
            BattleTab:AddButton({Name = "五条悟2(最強英雄)", Callback = function() getgenv().XiaoPi = "五条悟2(最強英雄)"; loadstring(game:HttpGet("https://raw.githubusercontent.com/jingbof50-lab/roblox_universe_script/refs/heads/main/script_gojo_satoru_2.lua", true))() end})
            BattleTab:AddButton({Name = "火車頭(英雄獵人)", Callback = function() getgenv().XiaoPi = "火車頭(英雄獵人)"; loadstring(game:HttpGet("https://raw.githubusercontent.com/jingbof50-lab/roblox_universe_script/main/script_the_flash_all.lua"))() end})
            -- 偷走一顆腦紅Tab
            local BrainTab = Window:MakeTab({Name = "偷走一顆腦紅", Icon = "rbxassetid://111934201357670", PremiumOnly = false})
            BrainTab:AddButton({Name = "菜單(修改)", Callback = function() getgenv().XiaoPi = "菜單(修改)"; loadstring(game:HttpGet("https://raw.githubusercontent.com/jingbof50-lab/roblox_universe_script/main/script_Property_modification_menu"))() end}) -- 修正原代码XiaoPi赋值错误
        else
            -- 输入错误提示（可选，可根据需求删除）
            game.StarterGui:SetCore("SendNotification", {Title = "錯誤", Text = "密匙不正確，請重新輸入", Duration = 3})
            KeyTextBox.Text = "" -- 清空输入框
        end
    end
end)
